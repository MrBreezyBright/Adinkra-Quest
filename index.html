<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adinkra Kwantuo - Enhanced Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #e8e8e8;
        }
        
        #gameContainer {
            position: relative;
            width: 1000px;
            height: 750px;
            max-width: 95vw;
            max-height: 95vh;
            background: linear-gradient(to bottom, #2c3e50 0%, #34495e 50%, #8b4513 100%);
            border: 4px solid #2c3e50;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            margin: 0 auto;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: rgba(44, 62, 80, 0.95);
            color: #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 14px;
            z-index: 10;
            flex-wrap: wrap;
        }
        
        .ui-section {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .ui-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(52, 73, 94, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(236, 240, 241, 0.2);
        }
        
        #difficultyIndicator {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        #streakIndicator {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        #startScreen, #gameOverScreen, #modeSelectScreen, #puzzleScreen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.98), rgba(44, 62, 80, 0.95), rgba(52, 73, 94, 0.92));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 20;
            text-align: center;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        #gameOverScreen, #modeSelectScreen, #puzzleScreen, #pauseScreen, #victoryScreen, #globalRankingScreen {
            display: none;
        }
        
        .title {
            font-family: 'Orbitron', monospace;
            font-size: 52px;
            font-weight: 900;
            background: linear-gradient(45deg, #f39c12, #e67e22, #f39c12);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(243, 156, 18, 0.5);
            margin-bottom: 25px;
            letter-spacing: 4px;
            animation: titleGlow 3s ease-in-out infinite;
            position: relative;
        }
        
        @keyframes titleGlow {
            0%, 100% { 
                background-position: 0% 50%;
                text-shadow: 0 0 30px rgba(243, 156, 18, 0.5);
            }
            50% { 
                background-position: 100% 50%;
                text-shadow: 0 0 50px rgba(243, 156, 18, 0.8);
            }
        }
        
        .subtitle {
            font-family: 'Rajdhani', sans-serif;
            font-size: 22px;
            margin-bottom: 30px;
            color: #ecf0f1;
            font-weight: 400;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .btn {
            font-family: 'Rajdhani', sans-serif;
            padding: 18px 35px;
            font-size: 18px;
            font-weight: 600;
            border: 2px solid transparent;
            border-radius: 15px;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            cursor: pointer;
            margin: 12px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
            min-width: 160px;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(231, 76, 60, 0.6);
            background: linear-gradient(45deg, #c0392b, #e74c3c);
            border-color: rgba(255,255,255,0.3);
        }
        
        .btn.secondary {
            background: linear-gradient(45deg, #34495e, #2c3e50);
        }
        
        .btn.secondary:hover {
            background: linear-gradient(45deg, #2c3e50, #34495e);
        }
        
        .controls {
            margin-top: 20px;
            font-size: 14px;
            color: #bdc3c7;
            max-width: 700px;
            line-height: 1.6;
        }
        
        #instructions {
            max-width: 700px;
            line-height: 1.8;
            margin: 20px;
            font-size: 16px;
            color: #ecf0f1;
        }
        
        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px;
            max-width: 800px;
        }
        
        .mode-card {
            background: linear-gradient(135deg, rgba(52, 73, 94, 0.9), rgba(44, 62, 80, 0.8));
            padding: 30px;
            border-radius: 20px;
            border: 2px solid #e74c3c;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }
        
        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #e74c3c);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .mode-card:hover::before {
            transform: scaleX(1);
        }
        
        .mode-card:hover {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.3), rgba(243, 156, 18, 0.2));
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(231, 76, 60, 0.4);
            border-color: #f39c12;
        }
        
        .mode-title {
            font-family: 'Orbitron', monospace;
            font-size: 22px;
            font-weight: 700;
            color: #f39c12;
            margin-bottom: 12px;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .mode-desc {
            font-family: 'Rajdhani', sans-serif;
            font-size: 15px;
            color: #ecf0f1;
            line-height: 1.6;
            font-weight: 400;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px;
            max-width: 500px;
        }
        
        .stat-item {
            background: rgba(52, 73, 94, 0.8);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(236, 240, 241, 0.2);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #f39c12;
        }
        
        .stat-label {
            font-size: 12px;
            color: #bdc3c7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        #puzzleGrid {
            display: grid;
            grid-template-columns: repeat(3, 80px);
            gap: 10px;
            margin: 20px;
        }
        
        .puzzle-slot {
            width: 80px;
            height: 80px;
            border: 3px dashed #f39c12;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .puzzle-slot.filled {
            border: 3px solid #f39c12;
            background: rgba(243, 156, 18, 0.3);
        }
        
        .puzzle-slot:hover {
            background: rgba(231, 76, 60, 0.2);
        }
        
        .symbol-options {
            display: flex;
            gap: 15px;
            margin: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .symbol-option {
            width: 60px;
            height: 60px;
            border: 2px solid #e74c3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .symbol-option:hover {
            background: rgba(231, 76, 60, 0.3);
            transform: scale(1.1);
        }
        
        .symbol-option.used {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        #leaderboard {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            margin: 20px;
            max-width: 400px;
        }
        
        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #444;
        }
        
        .achievement-popup {
            position: absolute;
            top: 120px;
            right: 30px;
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: #2c3e50;
            padding: 20px 25px;
            border-radius: 15px;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            transform: translateX(350px);
            transition: transform 0.6s ease;
            z-index: 30;
            max-width: 300px;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .achievement-popup.show {
            transform: translateX(0);
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Enhanced symbol styling for more realistic appearance */
        .symbol-realistic {
            font-family: 'Arial Unicode MS', 'Segoe UI Symbol', sans-serif;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        /* Futuristic menu enhancements */
        .menu-glow {
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.3);
        }
        
        .menu-glow:hover {
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.5);
        }
        
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(39, 174, 96, 0.5);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 30px rgba(39, 174, 96, 0.8);
            }
        }
        
        /* Victory Screen Styles */
        #victoryScreen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 25;
            overflow: hidden;
        }
        
        .victory-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 25%, #d35400 50%, #e74c3c 75%, #c0392b 100%);
            animation: victoryGlow 4s ease-in-out infinite;
        }
        
        @keyframes victoryGlow {
            0%, 100% { 
                background: linear-gradient(135deg, #f39c12 0%, #e67e22 25%, #d35400 50%, #e74c3c 75%, #c0392b 100%);
            }
            50% { 
                background: linear-gradient(135deg, #e67e22 0%, #d35400 25%, #e74c3c 50%, #c0392b 75%, #f39c12 100%);
            }
        }
        
        .victory-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            z-index: 30;
            width: 90%;
            max-width: 800px;
        }
        
        .victory-title {
            font-family: 'Orbitron', monospace;
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
            animation: titleFloat 3s ease-in-out infinite;
        }
        
        @keyframes titleFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .victory-subtitle {
            font-family: 'Rajdhani', sans-serif;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 30px;
            color: #2c3e50;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.5);
        }
        
        .victory-message {
            font-family: 'Rajdhani', sans-serif;
            font-size: 20px;
            font-weight: 500;
            line-height: 1.6;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: messageGlow 2s ease-in-out infinite;
        }
        
        @keyframes messageGlow {
            0%, 100% { text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
            50% { text-shadow: 2px 2px 8px rgba(255,255,255,0.3); }
        }
        
        .victory-symbol {
            font-size: 120px;
            margin: 30px 0;
            animation: symbolPulse 2s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(255,255,255,0.8);
        }
        
        @keyframes symbolPulse {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 0 0 30px rgba(255,255,255,0.8);
            }
            50% { 
                transform: scale(1.1);
                text-shadow: 0 0 50px rgba(255,255,255,1);
            }
        }
        
        .victory-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
        }
        
        .victory-btn {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            letter-spacing: 2px;
            padding: 20px 40px;
            font-size: 18px;
            min-width: 180px;
            background: linear-gradient(45deg, #2c3e50, #34495e);
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        
        .victory-btn:hover {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            border-color: rgba(255,255,255,0.6);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
        }
        
        /* Ghanaian cultural elements */
        .victory-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255,215,0,0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255,215,0,0.3) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255,215,0,0.2) 0%, transparent 70%);
            animation: culturalGlow 6s ease-in-out infinite;
        }
        
        @keyframes culturalGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        /* Global Ranking Screen Styles */
        #globalRankingScreen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 25;
            overflow-y: auto;
        }
        
        .ranking-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 25%, #8b4513 50%, #e74c3c 75%, #c0392b 100%);
            animation: rankingGlow 6s ease-in-out infinite;
        }
        
        @keyframes rankingGlow {
            0%, 100% { 
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 25%, #8b4513 50%, #e74c3c 75%, #c0392b 100%);
            }
            50% { 
                background: linear-gradient(135deg, #34495e 0%, #8b4513 25%, #e74c3c 50%, #c0392b 75%, #2c3e50 100%);
            }
        }
        
        .ranking-content {
            position: relative;
            z-index: 30;
            padding: 40px 20px;
            max-width: 900px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .ranking-title {
            font-family: 'Orbitron', monospace;
            font-size: 42px;
            font-weight: 900;
            text-align: center;
            color: #f39c12;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
            animation: titleFloat 3s ease-in-out infinite;
        }
        
        .ranking-subtitle {
            font-family: 'Rajdhani', sans-serif;
            font-size: 20px;
            text-align: center;
            color: #ecf0f1;
            margin-bottom: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .ranking-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .ranking-tab {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            padding: 12px 24px;
            background: rgba(52, 73, 94, 0.8);
            border: 2px solid rgba(243, 156, 18, 0.3);
            border-radius: 25px;
            color: #ecf0f1;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            letter-spacing: 1px;
        }
        
        .ranking-tab:hover {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
            transform: translateY(-2px);
        }
        
        .ranking-tab.active {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            border-color: #f39c12;
            color: #2c3e50;
            font-weight: 700;
        }
        
        .ranking-list {
            background: rgba(44, 62, 80, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(243, 156, 18, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .ranking-entry {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: rgba(52, 73, 94, 0.6);
            border-radius: 15px;
            border: 1px solid rgba(236, 240, 241, 0.2);
            transition: all 0.3s ease;
        }
        
        .ranking-entry:hover {
            background: rgba(243, 156, 18, 0.2);
            transform: translateX(5px);
        }
        
        .ranking-entry.current {
            background: linear-gradient(45deg, rgba(243, 156, 18, 0.4), rgba(230, 126, 34, 0.4));
            border-color: #f39c12;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.3);
        }
        
        .ranking-position {
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            font-weight: 900;
            color: #f39c12;
            min-width: 60px;
            text-align: center;
        }
        
        .ranking-position.gold { color: #FFD700; }
        .ranking-position.silver { color: #C0C0C0; }
        .ranking-position.bronze { color: #CD7F32; }
        
        .ranking-player {
            flex: 1;
            margin-left: 20px;
        }
        
        .ranking-name {
            font-family: 'Rajdhani', sans-serif;
            font-size: 18px;
            font-weight: 600;
            color: #ecf0f1;
            margin-bottom: 5px;
        }
        
        .ranking-stats {
            font-family: 'Rajdhani', sans-serif;
            font-size: 14px;
            color: #bdc3c7;
        }
        
        .ranking-score {
            font-family: 'Orbitron', monospace;
            font-size: 20px;
            font-weight: 700;
            color: #e74c3c;
            text-align: right;
            min-width: 100px;
        }
        
        .ranking-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .no-rankings {
            text-align: center;
            color: #bdc3c7;
            font-family: 'Rajdhani', sans-serif;
            font-size: 18px;
            padding: 40px 20px;
        }
        
        /* Mobile Touch Controls */
        #mobileControls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: none;
            z-index: 15;
            pointer-events: none;
        }
        
        .mobile-controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .mobile-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(231, 76, 60, 0.8);
            border: 3px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.2s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        .mobile-btn:active {
            transform: scale(0.9);
            background: rgba(231, 76, 60, 1);
        }
        
        .mobile-btn.jump {
            background: rgba(243, 156, 18, 0.8);
        }
        
        .mobile-btn.super-jump {
            background: rgba(39, 174, 96, 0.8);
        }
        
        .mobile-btn.pause {
            background: rgba(52, 73, 94, 0.8);
        }
        
        .mobile-directional {
            display: flex;
            gap: 10px;
        }
        
        .mobile-directional .mobile-btn {
            width: 50px;
            height: 50px;
            font-size: 20px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            #gameContainer {
                width: 100vw;
                height: 100vh;
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 0;
                border: none;
            }
            
            .victory-title {
                font-size: 32px;
            }
            
            .victory-subtitle {
                font-size: 18px;
            }
            
            .victory-message {
                font-size: 16px;
            }
            
            .victory-symbol {
                font-size: 80px;
            }
            
            .victory-actions {
                flex-direction: column;
                gap: 15px;
            }
            
            .victory-btn {
                padding: 16px 32px;
                font-size: 16px;
                min-width: 160px;
            }
            
            .ranking-title {
                font-size: 28px;
            }
            
            .ranking-subtitle {
                font-size: 16px;
            }
            
            .ranking-tabs {
                gap: 10px;
            }
            
            .ranking-tab {
                padding: 10px 20px;
                font-size: 12px;
            }
            
            .ranking-list {
                padding: 20px;
            }
            
            .ranking-entry {
                padding: 12px 15px;
            }
            
            .ranking-name {
                font-size: 16px;
            }
            
            .ranking-stats {
                font-size: 12px;
            }
            
            .ranking-score {
                font-size: 18px;
                min-width: 80px;
            }
            
            #gameCanvas {
                width: 100% !important;
                height: 100% !important;
            }
            
            .title { 
                font-size: 32px; 
                letter-spacing: 2px;
            }
            
            .subtitle { 
                font-size: 16px; 
                margin-bottom: 20px;
            }
            
            .btn {
                padding: 16px 28px;
                font-size: 16px;
                min-width: 140px;
                margin: 8px;
            }
            
            .mode-grid { 
                grid-template-columns: 1fr; 
                gap: 15px;
                margin: 15px;
            }
            
            .mode-card {
                padding: 20px;
            }
            
            .mode-title {
                font-size: 18px;
            }
            
            .mode-desc {
                font-size: 14px;
            }
            
            #ui { 
                font-size: 12px; 
                padding: 10px;
                flex-direction: column;
                gap: 10px;
            }
            
            .ui-section { 
                gap: 8px; 
                justify-content: center;
            }
            
            .ui-item {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            #mobileControls {
                display: block;
            }
            
            /* Hide pause screen on mobile when game is running */
            #pauseScreen {
                display: none !important;
            }
        }
        
        @media (max-width: 480px) {
            .title { 
                font-size: 28px; 
                letter-spacing: 1px;
            }
            
            .victory-title {
                font-size: 24px;
            }
            
            .victory-subtitle {
                font-size: 14px;
            }
            
            .victory-message {
                font-size: 14px;
            }
            
            .victory-symbol {
                font-size: 60px;
            }
            
            .victory-btn {
                padding: 14px 28px;
                font-size: 14px;
                min-width: 140px;
            }
            
            .ranking-title {
                font-size: 24px;
            }
            
            .ranking-subtitle {
                font-size: 14px;
            }
            
            .ranking-tabs {
                flex-direction: column;
                gap: 8px;
            }
            
            .ranking-tab {
                padding: 8px 16px;
                font-size: 11px;
            }
            
            .ranking-list {
                padding: 15px;
            }
            
            .ranking-entry {
                padding: 10px 12px;
                flex-direction: column;
                text-align: center;
            }
            
            .ranking-position {
                font-size: 20px;
                margin-bottom: 5px;
            }
            
            .ranking-player {
                margin-left: 0;
                margin-bottom: 5px;
            }
            
            .ranking-name {
                font-size: 14px;
            }
            
            .ranking-stats {
                font-size: 11px;
            }
            
            .ranking-score {
                font-size: 16px;
                min-width: auto;
                text-align: center;
            }
            
            .subtitle { 
                font-size: 14px; 
            }
            
            .btn {
                padding: 14px 24px;
                font-size: 14px;
                min-width: 120px;
                margin: 6px;
            }
            
            .mode-card {
                padding: 15px;
            }
            
            .mode-title {
                font-size: 16px;
            }
            
            .mode-desc {
                font-size: 12px;
            }
            
            #ui { 
                font-size: 10px; 
                padding: 8px;
            }
            
            .ui-item {
                padding: 4px 8px;
                font-size: 10px;
            }
            
            .mobile-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .mobile-directional .mobile-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            #mobileControls {
                bottom: 15px;
                left: 15px;
                right: 15px;
            }
        }
        
        /* Landscape orientation adjustments */
        @media (max-width: 768px) and (orientation: landscape) {
            #gameContainer {
                height: 100vh;
            }
            
            .title {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 12px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 12px;
                min-width: 100px;
            }
            
            #mobileControls {
                bottom: 10px;
            }
            
            .mobile-btn {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="1000" height="750"></canvas>
        
        <div id="ui">
            <div class="ui-section">
                <div class="ui-item">Score: <span id="score">0</span></div>
                <div class="ui-item">Symbols: <span id="symbols">0</span></div>
                <div class="ui-item">Lives: <span id="lives">3</span></div>
                <div class="ui-item" id="lifeProgress" style="display: none;">
                    Life Progress: <span id="symbolsToLife">0</span>/5
                </div>
            </div>
            <div class="ui-section">
                <div id="difficultyIndicator">AI: Easy</div>
                <div id="streakIndicator">Streak: <span id="streak">0</span></div>
                <div class="ui-item">Level: <span id="level">1</span></div>
                <div class="ui-item" id="winProgress" style="display: none;">
                    Home Progress: <span id="livesToWin">3</span>/12
                </div>
            </div>
        </div>
        
        <div id="startScreen">
            <div class="title">ADINKRA KWANTUO</div>
            <div class="subtitle">Advanced Ghanaian Heritage Experience - 2025</div>
            <div style="margin: 20px 0; font-family: 'Rajdhani', sans-serif; font-size: 16px; color: #f39c12; font-weight: 600; letter-spacing: 1px;">
                Created by: Bright K. Akowuah | Breezy ArtDrop Studios
            </div>
            
            <div style="display: flex; gap: 40px; margin: 30px 0; max-width: 800px;">
                <div style="flex: 1; text-align: left;">
                    <h3 style="font-family: 'Orbitron', monospace; color: #e74c3c; margin-bottom: 15px; font-size: 18px;">🎯 MISSION</h3>
                    <p style="font-family: 'Rajdhani', sans-serif; font-size: 15px; line-height: 1.6; color: #ecf0f1;">
                        Master the sacred Adinkra symbols of Ghana and unlock their ancient wisdom through immersive gameplay.
                    </p>
                </div>
                <div style="flex: 1; text-align: left;">
                    <h3 style="font-family: 'Orbitron', monospace; color: #e74c3c; margin-bottom: 15px; font-size: 18px;">🌟 FEATURES</h3>
                    <p style="font-family: 'Rajdhani', sans-serif; font-size: 15px; line-height: 1.6; color: #ecf0f1;">
                        Authentic cultural symbols, dynamic AI opponents, immersive sound design, and multiple adventure modes.
                    </p>
                </div>
            </div>
            
            <div style="display: flex; gap: 20px; margin: 30px 0;">
                <button class="btn menu-glow" onclick="showModeSelect()">SELECT ADVENTURE</button>
                <button class="btn secondary menu-glow" onclick="showGlobalRankings()">GLOBAL RANKINGS</button>
            </div>
            
            <div style="background: rgba(44, 62, 80, 0.6); padding: 25px; border-radius: 15px; border: 1px solid rgba(231, 76, 60, 0.3); max-width: 700px;">
                <h3 style="font-family: 'Orbitron', monospace; color: #f39c12; margin-bottom: 15px; font-size: 16px; text-align: center;">🎮 CONTROLS</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-family: 'Rajdhani', sans-serif; font-size: 14px;">
                    <div>
                        <strong style="color: #e74c3c;">Movement:</strong> ← → Arrow Keys<br>
                        <strong style="color: #e74c3c;">Jump:</strong> SPACE or TAP<br>
                        <strong style="color: #e74c3c;">Super Jump:</strong> ↑ or W<br>
                        <strong style="color: #e74c3c;">Pause:</strong> ESC or P
                    </div>
                    <div>
                        <strong style="color: #e74c3c;">Collect:</strong> Adinkra Symbols<br>
                        <strong style="color: #e74c3c;">Avoid:</strong> Obstacles<br>
                        <strong style="color: #e74c3c;">Life Bonus:</strong> Every 5 symbols<br>
                        <strong style="color: #e74c3c;">Victory:</strong> Reach 12 lives
                    </div>
                </div>
            </div>
        </div>
        
        <div id="modeSelectScreen">
            <div class="title">SELECT YOUR ADVENTURE</div>
            <div class="mode-grid">
                <div class="mode-card" onclick="startGame('classic')">
                    <div class="mode-title">🏃‍♂️ Classic Quest</div>
                    <div class="mode-desc">Traditional endless runner with authentic Adinkra symbols and enhanced sound design</div>
                </div>
                <div class="mode-card" onclick="startGame('competitive')">
                    <div class="mode-title">🏆 Competitive Race</div>
                    <div class="mode-desc">Race against sophisticated AI opponents with dynamic difficulty and cultural rewards</div>
                </div>
                <div class="mode-card" onclick="showPuzzleMode()">
                    <div class="mode-title">🧩 Puzzle Challenge</div>
                    <div class="mode-desc">Solve complex Adinkra symbol puzzles with authentic cultural context and meanings</div>
                </div>
                <div class="mode-card" onclick="startGame('festival')">
                    <div class="mode-title">🎉 Festival Mode</div>
                    <div class="mode-desc">Special cultural celebration with enhanced rewards and unique ceremonial sounds</div>
                </div>
                <div class="mode-card" onclick="startGame('survival')">
                    <div class="mode-title">💀 Survival Mode</div>
                    <div class="mode-desc">Extreme challenge with one life, maximum difficulty, and prestige cultural rewards</div>
                </div>
                <div class="mode-card" onclick="startGame('story')">
                    <div class="mode-title">📖 Story Mode</div>
                    <div class="mode-desc">Narrative-driven experience with authentic Akan cultural storytelling</div>
                </div>
            </div>
            <button class="btn secondary" onclick="backToStart()">Return to Main Menu</button>
        </div>
        
        <div id="puzzleScreen">
            <div class="title">Adinkra Wisdom Puzzle</div>
            <div class="subtitle">Arrange the sacred symbols to unlock the path forward</div>
            <div id="puzzleInstructions">Complete the pattern: <span id="puzzlePattern"></span></div>
            <div id="puzzleGrid"></div>
            <div class="symbol-options" id="symbolOptions"></div>
            <div style="margin: 20px;">
                <button class="btn" onclick="checkPuzzle()">Check Solution</button>
                <button class="btn secondary" onclick="resetPuzzle()">Reset</button>
                <button class="btn secondary" onclick="skipPuzzle()">Skip (Cost: 200 points)</button>
            </div>
            <button class="btn secondary" onclick="backToModes()">Back to Modes</button>
        </div>
        
        <div id="pauseScreen">
            <div class="title">GAME PAUSED</div>
            <div class="subtitle">Take a moment to rest, warrior</div>
            <div style="margin: 30px 0;">
                <button class="btn" onclick="resumeGame()">CONTINUE QUEST</button>
                <button class="btn secondary" onclick="backToModes()">MAIN MENU</button>
            </div>
            <div style="background: rgba(44, 62, 80, 0.6); padding: 20px; border-radius: 15px; border: 1px solid rgba(231, 76, 60, 0.3); max-width: 500px;">
                <h3 style="font-family: 'Orbitron', monospace; color: #f39c12; margin-bottom: 15px; font-size: 16px; text-align: center;">🎮 PAUSE CONTROLS</h3>
                <div style="font-family: 'Rajdhani', sans-serif; font-size: 14px; text-align: center;">
                    <strong style="color: #e74c3c;">Pause:</strong> ESC or P key<br>
                    <strong style="color: #e74c3c;">Resume:</strong> ESC, P, or SPACE
                </div>
            </div>
        </div>
        
        <div id="gameOverScreen">
            <div class="title">Quest Complete</div>
            <div class="subtitle" id="gameOverSubtitle">Your journey through Ghana has concluded</div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="finalScore">0</div>
                    <div class="stat-label">Final Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="finalSymbols">0</div>
                    <div class="stat-label">Symbols Collected</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="maxStreak">0</div>
                    <div class="stat-label">Max Streak</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="finalDifficulty">Easy</div>
                    <div class="stat-label">AI Difficulty</div>
                </div>
            </div>
                    <div id="leaderboard">
            <div style="font-size: 20px; margin-bottom: 20px; color: #f39c12;">🏆 Global Rankings</div>
            <div id="leaderboardList"></div>
        </div>
        
        <div id="globalRankingScreen">
            <div class="ranking-background">
                <div class="ranking-content">
                    <div class="ranking-title">🏆 GLOBAL RANKINGS</div>
                    <div class="ranking-subtitle">Champions of Adinkra Kwantuo</div>
                    
                    <div class="ranking-tabs">
                        <button class="ranking-tab active" onclick="showRankingTab('all')">All Time</button>
                        <button class="ranking-tab" onclick="showRankingTab('weekly')">This Week</button>
                        <button class="ranking-tab" onclick="showRankingTab('monthly')">This Month</button>
                    </div>
                    
                    <div class="ranking-list" id="rankingList">
                        <!-- Rankings will be populated here -->
                    </div>
                    
                    <div class="ranking-actions">
                        <button class="btn" onclick="refreshRankings()">🔄 Refresh</button>
                        <button class="btn secondary" onclick="backToStart()">← Back to Menu</button>
                    </div>
                </div>
            </div>
        </div>
            <div>
                <button class="btn" onclick="restartGame()">New Quest</button>
                <button class="btn secondary" onclick="backToModes()">Change Mode</button>
            </div>
        </div>
        
        <div id="victoryScreen">
            <div class="victory-background">
                <div class="victory-content">
                    <div class="victory-title">GHANA – THE WARRIOR KING</div>
                    <div class="victory-subtitle">(HOME)</div>
                    <div class="victory-message">
                        You Have Returned Home, Brave One.<br>
                        GHANA – THE WARRIOR KING Welcomes You.
                    </div>
                    <div class="victory-symbol">◉</div>
                    <div class="victory-actions">
                        <button class="btn victory-btn" onclick="playAgain()">PLAY AGAIN</button>
                        <button class="btn secondary victory-btn" onclick="shareVictory()">SHARE VICTORY</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="achievementPopup" class="achievement-popup">
            <div id="achievementText"></div>
        </div>
        
        <!-- Mobile Touch Controls -->
        <div id="mobileControls">
            <div class="mobile-controls-row">
                <div class="mobile-directional">
                    <div class="mobile-btn" id="leftBtn">←</div>
                    <div class="mobile-btn" id="rightBtn">→</div>
                </div>
                <div class="mobile-btn jump" id="jumpBtn">⬆</div>
            </div>
            <div class="mobile-controls-row">
                <div class="mobile-btn super-jump" id="superJumpBtn">⬆⬆</div>
                <div class="mobile-btn pause" id="pauseBtn">⏸</div>
            </div>
        </div>
    </div>

    <script>
        // Audio context and sound effects
        let audioContext;
        let sounds = {};
        
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                createSounds();
            } catch (error) {
                console.log('Audio not supported');
            }
        }
        
        function createSounds() {
            // Jump sound
            sounds.jump = createBeep(200, 0.1, 'sine');
            // Collect symbol sound
            sounds.collect = createChime([330, 415, 523], 0.3);
            // Achievement sound
            sounds.achievement = createChime([523, 659, 784, 1047], 0.5);
            // Game over sound
            sounds.gameOver = createBeep(150, 0.8, 'sawtooth');
            // Victory sound
            sounds.victory = createVictoryChime();
            // Background ambient
            sounds.ambient = createAmbient();
        }
        
        function createBeep(frequency, duration, waveType = 'sine') {
            return () => {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = waveType;
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + duration);
            };
        }
        
        function createChime(frequencies, duration) {
            return () => {
                if (!audioContext) return;
                
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                        
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + duration);
                    }, index * 100);
                });
            };
        }
        
        function createVictoryChime() {
            return () => {
                if (!audioContext) return;
                
                const frequencies = [523, 659, 784, 1047, 1319, 1568];
                const duration = 0.3;
                
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                        
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + duration);
                    }, index * 150);
                });
            };
        }
        
        function createAmbient() {
            return () => {
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                const filter = audioContext.createBiquadFilter();
                
                oscillator.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 60;
                oscillator.type = 'sine';
                filter.type = 'lowpass';
                filter.frequency.value = 200;
                
                gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                
                oscillator.start();
                return oscillator;
            };
        }
        
        function playSound(soundName) {
            if (sounds[soundName]) {
                sounds[soundName]();
            }
        }
        
        // Game state and configuration
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Enhanced canvas setup with better performance
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const containerRect = container.getBoundingClientRect();
            
            // Set canvas size to match container with device pixel ratio
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            
            ctx.scale(dpr, dpr);
            
            // Update game dimensions for responsive gameplay
            if (isMobile) {
                // Adjust game elements for mobile
                player.width = Math.max(30, canvas.width * 0.04);
                player.height = Math.max(30, canvas.width * 0.04);
                
                // Scale obstacles and symbols for mobile
                obstacles.forEach(obs => {
                    obs.width = Math.max(20, canvas.width * 0.03);
                    obs.height = Math.max(20, canvas.width * 0.03);
                });
                
                adinkraSymbols.forEach(symbol => {
                    symbol.width = Math.max(20, canvas.width * 0.03);
                    symbol.height = Math.max(20, canvas.width * 0.03);
                });
            }
        }
        
        let gameState = {
            running: false,
            paused: false,
            mode: 'classic',
            score: 0,
            symbols: 0,
            lives: 3,
            level: 1,
            streak: 0,
            maxStreak: 0,
            gameSpeed: 2,
            aiDifficulty: 'Easy',
            lastObstacleTime: 0,
            lastSymbolTime: 0,
            lastDifficultyAdjust: 0,
            symbolsForLife: 0, // Track symbols collected for life bonus
            totalLives: 3 // Track total lives for win condition
        };
        
        // Player performance tracking
        let playerPerformance = {
            jumpsSuccessful: 0,
            jumpsFailed: 0,
            symbolsCollected: 0,
            symbolsMissed: 0,
            averageReactionTime: 500
        };
        
        // Enhanced player object with higher jump
        const player = {
            x: 100,
            y: 400,
            width: 40,
            height: 40,
            velocityY: 0,
            jumping: false,
            grounded: true,
            powerUp: null,
            powerUpTime: 0,
            jumpPower: -16  // Increased from -12 for higher jumps
        };
        
        // AI opponents for competitive mode
        let aiOpponents = [];
        
        // Authentic Adinkra symbols with cultural meanings - More realistic symbols
        const adinkraTypes = [
            { symbol: '◉', name: 'Adinkrahene', meaning: 'Chief of Adinkra symbols', points: 200, rarity: 'legendary' },
            { symbol: '⚔', name: 'Akoben', meaning: 'War Horn - Vigilance', points: 130, rarity: 'rare' },
            { symbol: '⚔', name: 'Akofena', meaning: 'Sword of war - Valor', points: 140, rarity: 'rare' },
            { symbol: '◊', name: 'Akokonan', meaning: 'The leg of a hen - Mercy', points: 110, rarity: 'uncommon' },
            { symbol: '♥', name: 'Akoma', meaning: 'The heart - Patience', points: 100, rarity: 'common' },
            { symbol: '♡', name: 'Akoma Ntoso', meaning: 'Linked hearts - Unity', points: 120, rarity: 'uncommon' },
            { symbol: '◈', name: 'Denkyem', meaning: 'Crocodile - Adaptability', points: 115, rarity: 'uncommon' },
            { symbol: '◉', name: 'Ananse Ntontan', meaning: 'Spider web - Wisdom', points: 125, rarity: 'rare' },
            { symbol: '◐', name: 'Asase Ye Duru', meaning: 'Earth has weight - Mother Earth', points: 135, rarity: 'rare' },
            { symbol: '◊', name: 'Aya', meaning: 'Fern - Endurance', points: 105, rarity: 'common' },
            { symbol: '◈', name: 'Bese Saka', meaning: 'Sack of cola nuts - Abundance', points: 110, rarity: 'uncommon' },
            { symbol: '◉', name: 'Bi Nka Bi', meaning: 'No one should bite the other', points: 90, rarity: 'common' },
            { symbol: '⚡', name: 'Nyame Dua', meaning: 'Tree of God - Protection', points: 150, rarity: 'rare' },
            { symbol: '◉', name: 'Gye Nyame', meaning: 'Except for God - Supremacy', points: 180, rarity: 'legendary' },
            { symbol: '◈', name: 'Sankofa', meaning: 'Go back and get it - Learn from past', points: 140, rarity: 'rare' },
            { symbol: '◊', name: 'Duafe', meaning: 'Wooden Comb - Beauty', points: 110, rarity: 'uncommon' }
        ];
        
        // Puzzle patterns with authentic symbols - More realistic
        const puzzlePatterns = [
            { name: "Divine Protection", pattern: ['◉', '⚡', '◉'], description: "Arrange symbols of divine power and protection" },
            { name: "Unity and Love", pattern: ['♥', '♡', '♥'], description: "Create a pattern of love and unity" },
            { name: "Wisdom Path", pattern: ['◉', '◈', '◊'], description: "Build a path of wisdom and endurance" },
            { name: "Sacred Authority", pattern: ['◉', '◉', '◉'], description: "Channel the power of leadership" }
        ];
        
        let currentPuzzle = null;
        let puzzleGrid = ['', '', ''];
        
        // Game objects
        let obstacles = [];
        let adinkraSymbols = [];
        let backgroundElements = [];
        let particles = [];
        
        // Global Rankings System
        let globalRankings = {
            allTime: [
                { name: "Kwame", score: 12500, symbols: 65, mode: "competitive", date: "2024-01-15", lives: 12 },
                { name: "Akosua", score: 11800, symbols: 58, mode: "classic", date: "2024-01-14", lives: 12 },
                { name: "Kofi", score: 11200, symbols: 52, mode: "survival", date: "2024-01-13", lives: 12 },
                { name: "Ama", score: 10500, symbols: 48, mode: "festival", date: "2024-01-12", lives: 11 },
                { name: "Yaw", score: 9800, symbols: 45, mode: "story", date: "2024-01-11", lives: 10 },
                { name: "Efua", score: 9200, symbols: 42, mode: "competitive", date: "2024-01-10", lives: 9 },
                { name: "Mensah", score: 8800, symbols: 40, mode: "classic", date: "2024-01-09", lives: 8 },
                { name: "Abena", score: 8400, symbols: 38, mode: "survival", date: "2024-01-08", lives: 7 },
                { name: "Kwesi", score: 8000, symbols: 36, mode: "festival", date: "2024-01-07", lives: 6 },
                { name: "Adwoa", score: 7600, symbols: 34, mode: "story", date: "2024-01-06", lives: 5 }
            ],
            weekly: [
                { name: "Kwame", score: 12500, symbols: 65, mode: "competitive", date: "2024-01-15", lives: 12 },
                { name: "Akosua", score: 11800, symbols: 58, mode: "classic", date: "2024-01-14", lives: 12 },
                { name: "Kofi", score: 11200, symbols: 52, mode: "survival", date: "2024-01-13", lives: 12 },
                { name: "Ama", score: 10500, symbols: 48, mode: "festival", date: "2024-01-12", lives: 11 },
                { name: "Yaw", score: 9800, symbols: 45, mode: "story", date: "2024-01-11", lives: 10 }
            ],
            monthly: [
                { name: "Kwame", score: 12500, symbols: 65, mode: "competitive", date: "2024-01-15", lives: 12 },
                { name: "Akosua", score: 11800, symbols: 58, mode: "classic", date: "2024-01-14", lives: 12 },
                { name: "Kofi", score: 11200, symbols: 52, mode: "survival", date: "2024-01-13", lives: 12 },
                { name: "Ama", score: 10500, symbols: 48, mode: "festival", date: "2024-01-12", lives: 11 },
                { name: "Yaw", score: 9800, symbols: 45, mode: "story", date: "2024-01-11", lives: 10 },
                { name: "Efua", score: 9200, symbols: 42, mode: "competitive", date: "2024-01-10", lives: 9 },
                { name: "Mensah", score: 8800, symbols: 40, mode: "classic", date: "2024-01-09", lives: 8 },
                { name: "Abena", score: 8400, symbols: 38, mode: "survival", date: "2024-01-08", lives: 7 }
            ]
        };
        
        let currentRankingTab = 'allTime';
        
        // Legacy leaderboard for game over screen
        let leaderboard = globalRankings.allTime.slice(0, 5);
        
        // Input handling
        let keys = {};
        let touchStartTime = 0;
        let lastJumpTime = 0;
        let isMobile = false;
        let mobileControls = {};
        
        // Mobile detection
        function detectMobile() {
            isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                      window.innerWidth <= 768;
            return isMobile;
        }
        
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            // Pause/Resume controls
            if (e.code === 'Escape' || e.code === 'KeyP') {
                e.preventDefault();
                if (gameState.running && !gameState.paused) {
                    pauseGame();
                } else if (gameState.running && gameState.paused) {
                    resumeGame();
                }
                return;
            }
            
            if (e.code === 'Space') {
                e.preventDefault();
                if (gameState.paused) {
                    resumeGame();
                } else {
                    jump();
                }
            }
            if (e.code === 'ArrowUp' || e.code === 'KeyW') {
                e.preventDefault();
                if (!gameState.paused) {
                    superJump();
                }
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
        
        // Touch controls
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartTime = Date.now();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            
            if (x < canvas.width / 3) {
                keys['ArrowLeft'] = true;
            } else if (x > (canvas.width * 2) / 3) {
                keys['ArrowRight'] = true;
            } else {
                jump();
            }
        });
        
        canvas.addEventListener('touchend', (e) => {
            keys['ArrowLeft'] = false;
            keys['ArrowRight'] = false;
        });
        
        // Mobile touch controls
        function initMobileControls() {
            if (!isMobile) return;
            
            // Left button
            document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                keys['ArrowLeft'] = true;
            });
            
            document.getElementById('leftBtn').addEventListener('touchend', (e) => {
                e.preventDefault();
                keys['ArrowLeft'] = false;
            });
            
            // Right button
            document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                keys['ArrowRight'] = true;
            });
            
            document.getElementById('rightBtn').addEventListener('touchend', (e) => {
                e.preventDefault();
                keys['ArrowRight'] = false;
            });
            
            // Jump button
            document.getElementById('jumpBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (gameState.paused) {
                    resumeGame();
                } else {
                    jump();
                }
            });
            
            // Super jump button
            document.getElementById('superJumpBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!gameState.paused) {
                    superJump();
                }
            });
            
            // Pause button
            document.getElementById('pauseBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (gameState.running && !gameState.paused) {
                    pauseGame();
                } else if (gameState.running && gameState.paused) {
                    resumeGame();
                }
            });
        }
        
        // Enhanced jump function with better physics
        function jump() {
            const currentTime = Date.now();
            if (currentTime - lastJumpTime < 250) return; // Reduced cooldown for better responsiveness
            
            if (player.grounded && gameState.running) {
                const reactionTime = Date.now() - touchStartTime;
                playerPerformance.averageReactionTime = 
                    (playerPerformance.averageReactionTime + reactionTime) / 2;
                
                player.velocityY = player.jumpPower;
                player.jumping = true;
                player.grounded = false;
                lastJumpTime = currentTime;
                
                // Play jump sound
                playSound('jump');
                
                // Create jump particles
                createParticles(player.x + player.width/2, player.y + player.height, '#f39c12', 'common');
                
                // Performance tracking
                const nearbyObstacle = obstacles.find(obs => 
                    Math.abs(obs.x - player.x) < 100 && obs.x > player.x
                );
                if (nearbyObstacle) {
                    playerPerformance.jumpsSuccessful++;
                } else {
                    playerPerformance.jumpsFailed++;
                }
            }
        }
        
        // Enhanced super jump function
        function superJump() {
            const currentTime = Date.now();
            if (currentTime - lastJumpTime < 250) return;
            
            if (player.grounded && gameState.running) {
                const reactionTime = Date.now() - touchStartTime;
                playerPerformance.averageReactionTime = 
                    (playerPerformance.averageReactionTime + reactionTime) / 2;
                
                player.velocityY = player.jumpPower * 1.8;
                player.jumping = true;
                player.grounded = false;
                lastJumpTime = currentTime;
                
                // Play enhanced jump sound for super jump
                playSound('achievement');
                
                // Create special particle effect for super jump
                createParticles(player.x + player.width/2, player.y + player.height, '#f39c12', 'rare');
                
                // Performance tracking
                const nearbyObstacle = obstacles.find(obs => 
                    Math.abs(obs.x - player.x) < 100 && obs.x > player.x
                );
                if (nearbyObstacle) {
                    playerPerformance.jumpsSuccessful++;
                } else {
                    playerPerformance.jumpsFailed++;
                }
                
                // Show super jump indicator
                showAchievement("Super Jump! 🚀");
            }
        }
        
        // Initialize background
        function initBackground() {
            backgroundElements = [];
            for (let i = 0; i < 15; i++) {
                backgroundElements.push({
                    x: Math.random() * canvas.width * 3,
                    y: Math.random() * 200 + 50,
                    type: ['tree', 'mountain', 'village', 'market'][Math.floor(Math.random() * 4)],
                    speed: Math.random() * 0.5 + 0.2,
                    color: ['#27ae60', '#8b7355', '#e74c3c', '#f39c12'][Math.floor(Math.random() * 4)]
                });
            }
        }
        
        // Initialize AI opponents
        function initAIOpponents() {
            aiOpponents = [];
            const names = ['Kwame AI', 'Akosua AI', 'Kofi AI'];
            for (let i = 0; i < 3; i++) {
                aiOpponents.push({
                    name: names[i],
                    x: 80 + i * 30,
                    y: 575,
                    score: 0,
                    speed: 2 + Math.random() * 1,
                    color: ['#e74c3c', '#f39c12', '#27ae60'][i]
                });
            }
        }
        
        // AI difficulty adjustment
        function adjustAIDifficulty() {
            const currentTime = Date.now();
            if (currentTime - gameState.lastDifficultyAdjust < 15000) return;
            
            gameState.lastDifficultyAdjust = currentTime;
            
            const successRate = playerPerformance.jumpsSuccessful / 
                (playerPerformance.jumpsSuccessful + playerPerformance.jumpsFailed || 1);
            const collectionRate = playerPerformance.symbolsCollected / 
                (playerPerformance.symbolsCollected + playerPerformance.symbolsMissed || 1);
            
            const performanceScore = (successRate * 0.6) + (collectionRate * 0.4);
            
            if (performanceScore > 0.8) {
                increaseDifficulty();
            } else if (performanceScore < 0.4) {
                decreaseDifficulty();
            }
            
            document.getElementById('difficultyIndicator').textContent = `AI: ${gameState.aiDifficulty}`;
        }
        
        function increaseDifficulty() {
            const difficulties = ['Easy', 'Medium', 'Hard', 'Expert', 'Master'];
            const currentIndex = difficulties.indexOf(gameState.aiDifficulty);
            
            if (currentIndex < difficulties.length - 1) {
                gameState.aiDifficulty = difficulties[currentIndex + 1];
                gameState.gameSpeed += 0.5;
                showAchievement(`AI Difficulty Increased to ${gameState.aiDifficulty}!`);
                playSound('achievement');
            }
        }
        
        function decreaseDifficulty() {
            const difficulties = ['Easy', 'Medium', 'Hard', 'Expert', 'Master'];
            const currentIndex = difficulties.indexOf(gameState.aiDifficulty);
            
            if (currentIndex > 0) {
                gameState.aiDifficulty = difficulties[currentIndex - 1];
                gameState.gameSpeed = Math.max(gameState.gameSpeed - 0.5, 1);
                showAchievement(`AI Difficulty Decreased to ${gameState.aiDifficulty}`);
            }
        }
        
        // Enhanced player update with better physics
        function updatePlayer() {
            // Horizontal movement with smoother acceleration
            const moveSpeed = 6;
            if (keys['ArrowLeft'] && player.x > 0) {
                player.x -= moveSpeed;
            }
            if (keys['ArrowRight'] && player.x < canvas.width - player.width) {
                player.x += moveSpeed;
            }
            
            // Enhanced gravity and jumping physics
            const gravity = 0.85;
            const maxFallSpeed = 15;
            
            player.velocityY += gravity;
            if (player.velocityY > maxFallSpeed) {
                player.velocityY = maxFallSpeed;
            }
            
            player.y += player.velocityY;
            
            // Ground collision with better detection
            const groundY = canvas.height - 100; // Adjusted for better positioning
            if (player.y >= groundY - player.height) {
                player.y = groundY - player.height;
                player.velocityY = 0;
                player.jumping = false;
                player.grounded = true;
                
                // Create landing particles
                if (player.velocityY > 5) {
                    createParticles(player.x + player.width/2, player.y + player.height, '#8b4513', 'common');
                }
            }
            
            // Power-up management
            if (player.powerUp && Date.now() > player.powerUpTime) {
                player.powerUp = null;
            }
        }
        
        // Spawn obstacles
        function spawnObstacle(currentTime) {
            let spawnRate = 2000;
            const difficultyMultiplier = {
                'Easy': 1,
                'Medium': 0.8,
                'Hard': 0.6,
                'Expert': 0.4,
                'Master': 0.3
            };
            
            spawnRate *= difficultyMultiplier[gameState.aiDifficulty] || 1;
            
            if (currentTime - gameState.lastObstacleTime > spawnRate + Math.random() * 1000) {
                const obstacleTypes = ['rock', 'tree', 'market_stall'];
                const type = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
                
                obstacles.push({
                    x: canvas.width,
                    y: type === 'market_stall' ? 620 : 620,
                    width: type === 'market_stall' ? 50 : 30,
                    height: type === 'market_stall' ? 30 : 30,
                    type: type
                });
                gameState.lastObstacleTime = currentTime;
            }
        }
        
        // Spawn authentic Adinkra symbols
        function spawnSymbol(currentTime) {
            if (currentTime - gameState.lastSymbolTime > 1200 + Math.random() * 800) {
                const symbolType = adinkraTypes[Math.floor(Math.random() * adinkraTypes.length)];
                const isFestival = gameState.mode === 'festival';
                
                // Vary symbol heights - some high for super jump, some normal
                const isHighSymbol = Math.random() > 0.6; // 40% chance for high symbols
                const symbolY = isHighSymbol ? 
                    Math.random() * 200 + 80 :  // High symbols (require super jump)
                    Math.random() * 300 + 200;  // Normal height symbols
                
                adinkraSymbols.push({
                    x: canvas.width,
                    y: symbolY,
                    width: 30,
                    height: 30,
                    symbol: symbolType.symbol,
                    name: symbolType.name,
                    meaning: symbolType.meaning,
                    points: isFestival ? symbolType.points * 2 : symbolType.points,
                    rarity: symbolType.rarity,
                    collected: false,
                    festival: isFestival,
                    glowPhase: 0,
                    isHigh: isHighSymbol
                });
                gameState.lastSymbolTime = currentTime;
            }
        }
        
        // Update game objects
        function updateObstacles() {
            obstacles = obstacles.filter(obstacle => {
                obstacle.x -= gameState.gameSpeed;
                return obstacle.x > -obstacle.width;
            });
        }
        
        function updateSymbols() {
            adinkraSymbols = adinkraSymbols.filter(symbol => {
                symbol.x -= gameState.gameSpeed;
                symbol.glowPhase += 0.1;
                return symbol.x > -symbol.width;
            });
        }
        
        // Update AI opponents
        function updateAIOpponents() {
            if (gameState.mode !== 'competitive') return;
            
            aiOpponents.forEach(ai => {
                ai.x += ai.speed;
                ai.score += Math.floor(ai.speed);
                
                // Reset AI position if too far ahead
                if (ai.x > canvas.width) {
                    ai.x = Math.random() * 200;
                }
            });
        }
        
        // Enhanced collision detection with better precision
        function checkCollisions() {
            // Obstacle collisions with improved detection
            obstacles.forEach(obstacle => {
                if (player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y) {
                    
                    if (player.powerUp === 'shield') {
                        player.powerUp = null;
                        obstacle.x = -100;
                        showAchievement("Shield Protected You!");
                        playSound('achievement');
                        createParticles(obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2, '#3498db', 'rare');
                        return;
                    }
                    
                    gameState.lives--;
                    gameState.streak = 0;
                    obstacle.x = -100;
                    playerPerformance.jumpsFailed++;
                    
                    // Create collision particles
                    createParticles(player.x + player.width/2, player.y + player.height/2, '#e74c3c', 'common');
                    
                    if (gameState.lives <= 0) {
                        gameOver();
                    }
                }
            });
            
            // Enhanced symbol collections with better feedback
            adinkraSymbols.forEach(symbol => {
                if (!symbol.collected &&
                    player.x < symbol.x + symbol.width &&
                    player.x + player.width > symbol.x &&
                    player.y < symbol.y + symbol.height &&
                    player.y + player.height > symbol.y) {
                    
                    symbol.collected = true;
                    gameState.symbols++;
                    gameState.symbolsForLife++;
                    gameState.score += symbol.points;
                    gameState.streak++;
                    
                    if (gameState.streak > gameState.maxStreak) {
                        gameState.maxStreak = gameState.streak;
                    }
                    
                    playerPerformance.symbolsCollected++;
                    symbol.x = -100;
                    
                    // Play collection sound
                    playSound('collect');
                    
                    // Create enhanced particle effects based on rarity
                    const particleColor = symbol.festival ? '#f39c12' : '#e74c3c';
                    createParticles(symbol.x, symbol.y, particleColor, symbol.rarity);
                    
                    // Life bonus system - every 5 symbols collected gives 1 life
                    if (gameState.symbolsForLife >= 5) {
                        gameState.lives++;
                        gameState.totalLives++;
                        gameState.symbolsForLife = 0; // Reset counter
                        showAchievement("🌟 +1 LIFE BONUS! 🌟");
                        playSound('achievement');
                        
                        // Create special life bonus particles
                        createParticles(player.x + player.width/2, player.y + player.height/2, '#27ae60', 'legendary');
                        
                        // Check for victory condition (12 total lives) - only in goal mode
                        if (gameMode === 'goal' && gameState.totalLives >= 12) {
                            victory();
                            return;
                        }
                    }
                    
                    // Streak bonuses with sound
                    if (gameState.streak % 5 === 0) {
                        showAchievement(`${gameState.streak} Symbol Streak!`);
                        gameState.score += gameState.streak * 10;
                        playSound('achievement');
                    }
                    
                    // Cultural messages with authentic meanings
                    if (Math.random() > 0.6) {
                        showAchievement(`${symbol.name}: ${symbol.meaning}`);
                    }
                }
            });
        }
        
        // Enhanced particle system with better performance and effects
        function createParticles(x, y, color, rarity = 'common') {
            // Reduce particle count on mobile for better performance
            const baseCount = isMobile ? 0.5 : 1;
            const particleCount = Math.floor((rarity === 'legendary' ? 25 : rarity === 'rare' ? 15 : 10) * baseCount);
            
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: x + (Math.random() - 0.5) * 20,
                    y: y + (Math.random() - 0.5) * 20,
                    vx: (Math.random() - 0.5) * (isMobile ? 6 : 10),
                    vy: (Math.random() - 0.5) * (isMobile ? 6 : 10),
                    color: color,
                    life: 1.0,
                    decay: isMobile ? 0.02 : 0.015,
                    size: Math.random() * (isMobile ? 3 : 5) + (isMobile ? 1 : 2),
                    twinkle: Math.random() * Math.PI * 2,
                    gravity: 0.1
                });
            }
        }
        
        function updateParticles() {
            particles = particles.filter(particle => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.vy += particle.gravity;
                particle.life -= particle.decay;
                particle.twinkle += 0.2;
                return particle.life > 0;
            });
        }
        
        function drawParticles() {
            particles.forEach(particle => {
                ctx.save();
                const alpha = particle.life * (0.5 + 0.5 * Math.sin(particle.twinkle));
                ctx.globalAlpha = alpha;
                ctx.fillStyle = particle.color;
                ctx.shadowColor = particle.color;
                ctx.shadowBlur = 3;
                ctx.fillRect(particle.x, particle.y, particle.size, particle.size);
                ctx.restore();
            });
        }
        
        // Enhanced drawing functions
        function drawBackground() {
            // Dynamic sky colors with smooth transitions
            let skyColors = ['#2c3e50', '#34495e', '#8b4513'];
            if (gameState.mode === 'festival') {
                skyColors = ['#e74c3c', '#f39c12', '#e67e22'];
            }
            
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, skyColors[0]);
            gradient.addColorStop(0.4, skyColors[1]);
            gradient.addColorStop(1, skyColors[2]);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Enhanced background elements with parallax effect
            backgroundElements.forEach(element => {
                element.x -= element.speed * gameState.gameSpeed;
                if (element.x < -100) {
                    element.x = canvas.width + Math.random() * 200;
                }
                
                ctx.fillStyle = element.color;
                ctx.globalAlpha = 0.8;
                drawBackgroundElement(element);
                ctx.globalAlpha = 1;
            });
            
            // Enhanced ground with authentic Kente pattern
            const groundY = canvas.height - 100;
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);
            
            // Authentic Kente pattern with better detail
            for (let i = 0; i < canvas.width; i += 40) {
                const colors = ['#e74c3c', '#f39c12', '#e67e22', '#27ae60'];
                ctx.fillStyle = colors[Math.floor(i / 40) % colors.length];
                ctx.fillRect(i, groundY, 40, 20);
                
                // Add traditional geometric patterns
                ctx.fillStyle = '#2c3e50';
                for (let j = 0; j < 4; j++) {
                    ctx.fillRect(i + j * 10 + 2, groundY + 2, 6, 3);
                    ctx.fillRect(i + j * 10 + 2, groundY + 10, 6, 3);
                    ctx.fillRect(i + j * 10 + 2, groundY + 15, 6, 3);
                }
            }
        }
        
        function drawBackgroundElement(element) {
            switch (element.type) {
                case 'tree':
                    // African Baobab-style tree
                    ctx.fillRect(element.x, element.y + 30, 15, 50);
                    ctx.beginPath();
                    ctx.arc(element.x + 7.5, element.y + 20, 25, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                case 'mountain':
                    ctx.beginPath();
                    ctx.moveTo(element.x, element.y + 60);
                    ctx.lineTo(element.x + 30, element.y);
                    ctx.lineTo(element.x + 60, element.y + 60);
                    ctx.closePath();
                    ctx.fill();
                    break;
                case 'village':
                    // Traditional African hut
                    ctx.fillRect(element.x, element.y + 20, 40, 30);
                    ctx.fillStyle = '#8b4513';
                    ctx.beginPath();
                    ctx.arc(element.x + 20, element.y + 20, 20, 0, Math.PI);
                    ctx.fill();
                    ctx.fillStyle = element.color;
                    break;
                case 'market':
                    // Traditional market stall
                    ctx.fillRect(element.x, element.y + 10, 50, 20);
                    ctx.fillStyle = '#e74c3c';
                    ctx.fillRect(element.x + 5, element.y + 15, 40, 10);
                    ctx.fillStyle = element.color;
                    break;
            }
        }
        
        function drawPlayer() {
            // Enhanced shield effect
            if (player.powerUp === 'shield') {
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 4;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.arc(player.x + player.width/2, player.y + player.height/2, 35, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Player body with enhanced African styling
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // Enhanced Kente clothing with more detail
            const patterns = ['#e74c3c', '#f39c12', '#e67e22', '#27ae60'];
            for (let i = 0; i < 4; i++) {
                ctx.fillStyle = patterns[i];
                ctx.fillRect(player.x + 6, player.y + 10 + i * 5, player.width - 12, 4);
                
                // Add traditional patterns
                ctx.fillStyle = '#2c3e50';
                for (let j = 0; j < 3; j++) {
                    ctx.fillRect(player.x + 8 + j * 10, player.y + 11 + i * 5, 2, 2);
                }
            }
            
            // Enhanced face
            ctx.fillStyle = '#654321';
            ctx.fillRect(player.x + 8, player.y + 3, 24, 18);
            
            // Eyes
            ctx.fillStyle = 'white';
            ctx.fillRect(player.x + 12, player.y + 8, 5, 4);
            ctx.fillRect(player.x + 23, player.y + 8, 5, 4);
            
            // Pupils
            ctx.fillStyle = 'black';
            ctx.fillRect(player.x + 14, player.y + 9, 2, 2);
            ctx.fillRect(player.x + 25, player.y + 9, 2, 2);
            
            // Traditional headwear with patterns
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(player.x + 3, player.y - 8, 34, 12);
            ctx.fillStyle = '#f39c12';
            ctx.fillRect(player.x + 6, player.y - 5, 28, 3);
            
            // Running animation
            const animFrame = Math.floor(Date.now() / 150) % 4;
            drawRunningLegs(animFrame);
        }
        
        function drawRunningLegs(frame) {
            ctx.fillStyle = '#8b4513';
            const legOffset = [0, 3, 0, -3][frame];
            
            // Left leg
            ctx.fillRect(player.x + 8, player.y + player.height + legOffset, 10, 10);
            // Right leg  
            ctx.fillRect(player.x + 22, player.y + player.height - legOffset, 10, 10);
        }
        
        function drawObstacles() {
            obstacles.forEach(obstacle => {
                switch (obstacle.type) {
                    case 'rock':
                        ctx.fillStyle = '#7f8c8d';
                        ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                        ctx.fillStyle = '#95a5a6';
                        ctx.fillRect(obstacle.x + 5, obstacle.y + 5, 20, 20);
                        break;
                    case 'tree':
                        ctx.fillStyle = '#8b4513';
                        ctx.fillRect(obstacle.x + 10, obstacle.y, 10, obstacle.height);
                        ctx.fillStyle = '#27ae60';
                        ctx.beginPath();
                        ctx.arc(obstacle.x + 15, obstacle.y, 15, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                    case 'market_stall':
                        ctx.fillStyle = '#e74c3c';
                        ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                        ctx.fillStyle = '#f39c12';
                        ctx.fillRect(obstacle.x + 5, obstacle.y + 5, obstacle.width - 10, 10);
                        // Add traditional goods
                        ctx.fillStyle = '#e67e22';
                        for (let i = 0; i < 3; i++) {
                            ctx.fillRect(obstacle.x + 10 + i * 10, obstacle.y + 20, 8, 8);
                        }
                        break;
                }
            });
        }
        
        // Enhanced symbol drawing with authentic Adinkra symbols
        function drawSymbols() {
            adinkraSymbols.forEach(symbol => {
                if (!symbol.collected) {
                    // Enhanced glow effect
                    const glowColor = symbol.festival ? '#f39c12' : '#e74c3c';
                    const glowIntensity = 0.7 + 0.3 * Math.sin(symbol.glowPhase);
                    
                    ctx.shadowColor = glowColor;
                    ctx.shadowBlur = symbol.festival ? 25 : 15;
                    
                    if (symbol.festival) {
                        // Festival sparkle effect
                        const sparkle = Math.sin(Date.now() / 100) * 0.4 + 0.6;
                        ctx.globalAlpha = sparkle;
                    }
                    
                    // Special visual indicator for high symbols
                    if (symbol.isHigh) {
                        ctx.strokeStyle = '#FFD700';
                        ctx.lineWidth = 2;
                        ctx.setLineDash([5, 5]);
                        ctx.beginPath();
                        ctx.arc(symbol.x + symbol.width/2, symbol.y + symbol.height/2, 25, 0, Math.PI * 2);
                        ctx.stroke();
                        ctx.setLineDash([]);
                        
                        // Add upward arrow indicator
                        ctx.fillStyle = '#FFD700';
                        ctx.font = 'bold 16px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('↑', symbol.x + symbol.width/2, symbol.y - 10);
                    }
                    
                    // Draw symbol with enhanced realistic styling
                    ctx.font = 'bold 32px Arial Unicode MS, Segoe UI Symbol, Arial';
                    ctx.fillStyle = glowColor;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(symbol.symbol, symbol.x + symbol.width/2, symbol.y + symbol.height/2);
                    
                    // Add subtle inner glow for more realistic appearance
                    ctx.shadowColor = 'rgba(255,255,255,0.3)';
                    ctx.shadowBlur = 3;
                    ctx.fillText(symbol.symbol, symbol.x + symbol.width/2, symbol.y + symbol.height/2);
                    ctx.shadowBlur = 0;
                    
                    // Rarity indicator
                    if (symbol.rarity === 'legendary') {
                        ctx.strokeStyle = '#FFD700';
                        ctx.lineWidth = 3;
                        ctx.beginPath();
                        ctx.arc(symbol.x + symbol.width/2, symbol.y + symbol.height/2, 20, 0, Math.PI * 2);
                        ctx.stroke();
                    } else if (symbol.rarity === 'rare') {
                        ctx.strokeStyle = '#9B59B6';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(symbol.x + symbol.width/2, symbol.y + symbol.height/2, 18, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                    
                    // Cultural meaning tooltip when close
                    if (Math.abs(symbol.x - player.x) < 60) {
                        ctx.font = '12px Arial';
                        ctx.fillStyle = 'white';
                        ctx.shadowBlur = 5;
                        ctx.fillText(symbol.name, symbol.x + symbol.width/2, symbol.y - 15);
                        ctx.font = '10px Arial';
                        ctx.fillText(symbol.meaning, symbol.x + symbol.width/2, symbol.y - 5);
                        
                        // Show super jump hint for high symbols
                        if (symbol.isHigh) {
                            ctx.font = '9px Arial';
                            ctx.fillStyle = '#FFD700';
                            ctx.fillText('Press ↑ or W for Super Jump!', symbol.x + symbol.width/2, symbol.y + 50);
                        }
                    }
                    
                    ctx.globalAlpha = 1;
                    ctx.shadowBlur = 0;
                }
            });
        }
        
        function drawAIOpponents() {
            if (gameState.mode !== 'competitive') return;
            
            aiOpponents.forEach((ai, index) => {
                ctx.fillStyle = ai.color;
                ctx.fillRect(ai.x, ai.y, 35, 35);
                
                // AI indicator
                ctx.fillStyle = 'white';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('AI', ai.x + 17, ai.y - 5);
                
                // AI score display
                ctx.fillText(ai.score.toString(), ai.x + 17, ai.y + 50);
            });
        }
        
        // UI and Menu Functions
        function showModeSelect() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('modeSelectScreen').style.display = 'flex';
        }
        
        function backToStart() {
            document.getElementById('modeSelectScreen').style.display = 'none';
            document.getElementById('puzzleScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'flex';
        }
        
        function backToModes() {
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('puzzleScreen').style.display = 'none';
            document.getElementById('modeSelectScreen').style.display = 'flex';
        }
        
        // Enhanced puzzle mode functions with authentic symbols
        function showPuzzleMode() {
            document.getElementById('modeSelectScreen').style.display = 'none';
            document.getElementById('puzzleScreen').style.display = 'flex';
            initPuzzle();
        }
        
        function initPuzzle() {
            currentPuzzle = puzzlePatterns[Math.floor(Math.random() * puzzlePatterns.length)];
            puzzleGrid = ['', '', ''];
            
            document.getElementById('puzzlePattern').textContent = 
                `${currentPuzzle.name} - ${currentPuzzle.description}`;
            
            updatePuzzleDisplay();
        }
        
        function updatePuzzleDisplay() {
            // Update grid
            const gridElement = document.getElementById('puzzleGrid');
            gridElement.innerHTML = '';
            
            puzzleGrid.forEach((symbol, index) => {
                const slot = document.createElement('div');
                slot.className = 'puzzle-slot' + (symbol ? ' filled' : '');
                slot.textContent = symbol;
                slot.onclick = () => clearPuzzleSlot(index);
                gridElement.appendChild(slot);
            });
            
            // Update available symbols
            const optionsElement = document.getElementById('symbolOptions');
            optionsElement.innerHTML = '';
            
            const uniqueSymbols = [...new Set(currentPuzzle.pattern)];
            uniqueSymbols.forEach(symbol => {
                const option = document.createElement('div');
                option.className = 'symbol-option';
                option.textContent = symbol;
                option.onclick = () => selectSymbol(symbol);
                optionsElement.appendChild(option);
            });
        }
        
        function selectSymbol(symbol) {
            const emptySlot = puzzleGrid.findIndex(slot => slot === '');
            if (emptySlot !== -1) {
                puzzleGrid[emptySlot] = symbol;
                updatePuzzleDisplay();
            }
        }
        
        function clearPuzzleSlot(index) {
            puzzleGrid[index] = '';
            updatePuzzleDisplay();
        }
        
        function checkPuzzle() {
            const isCorrect = JSON.stringify(puzzleGrid) === JSON.stringify(currentPuzzle.pattern);
            
            if (isCorrect) {
                showAchievement(`Puzzle Solved! +500 points`);
                gameState.score += 500;
                playSound('achievement');
                startGame('classic');
            } else {
                showAchievement('Not quite right. Try again!');
            }
        }
        
        function resetPuzzle() {
            initPuzzle();
        }
        
        function skipPuzzle() {
            if (gameState.score >= 200) {
                gameState.score -= 200;
                startGame('classic');
            } else {
                showAchievement('Not enough points to skip!');
            }
        }
        
        // Enhanced achievement system with sound
        function showAchievement(text) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementText').textContent = text;
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3500);
        }
        
        // Global Ranking Functions
        function showGlobalRankings() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('globalRankingScreen').style.display = 'block';
            showRankingTab('all');
        }
        
        function showRankingTab(tab) {
            currentRankingTab = tab === 'all' ? 'allTime' : tab === 'weekly' ? 'weekly' : 'monthly';
            
            // Update tab buttons
            document.querySelectorAll('.ranking-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update rankings display
            updateRankingsDisplay();
        }
        
        function updateRankingsDisplay() {
            const rankingList = document.getElementById('rankingList');
            const rankings = globalRankings[currentRankingTab];
            
            if (rankings.length === 0) {
                rankingList.innerHTML = '<div class="no-rankings">No rankings available for this period.</div>';
                return;
            }
            
            rankingList.innerHTML = '';
            
            rankings.forEach((entry, index) => {
                const rankingEntry = document.createElement('div');
                rankingEntry.className = 'ranking-entry';
                
                // Add special styling for top 3
                let positionClass = '';
                if (index === 0) positionClass = 'gold';
                else if (index === 1) positionClass = 'silver';
                else if (index === 2) positionClass = 'bronze';
                
                const position = index + 1;
                const positionText = position === 1 ? '🥇' : position === 2 ? '🥈' : position === 3 ? '🥉' : position;
                
                rankingEntry.innerHTML = `
                    <div class="ranking-position ${positionClass}">${positionText}</div>
                    <div class="ranking-player">
                        <div class="ranking-name">${entry.name}</div>
                        <div class="ranking-stats">
                            ${entry.mode.charAt(0).toUpperCase() + entry.mode.slice(1)} Mode • 
                            ${entry.symbols} Symbols • 
                            ${entry.lives} Lives • 
                            ${formatDate(entry.date)}
                        </div>
                    </div>
                    <div class="ranking-score">${entry.score.toLocaleString()}</div>
                `;
                
                rankingList.appendChild(rankingEntry);
            });
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) return 'Today';
            if (diffDays === 2) return 'Yesterday';
            if (diffDays <= 7) return `${diffDays - 1} days ago`;
            
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        function refreshRankings() {
            // Simulate refreshing rankings
            showAchievement('Rankings refreshed! 🔄');
            updateRankingsDisplay();
        }
        
        // Legacy leaderboard functions
        function showLeaderboard() {
            updateLeaderboardDisplay();
        }
        
        function updateLeaderboardDisplay() {
            const listElement = document.getElementById('leaderboardList');
            listElement.innerHTML = '';
            
            leaderboard.slice(0, 5).forEach((entry, index) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'leaderboard-entry';
                entryDiv.innerHTML = `
                    <span>#${index + 1} ${entry.name}</span>
                    <span>${entry.score} pts</span>
                `;
                listElement.appendChild(entryDiv);
            });
        }
        
        function updateLeaderboard() {
            // Add current score to leaderboard
            leaderboard.push({
                name: "You",
                score: gameState.score,
                symbols: gameState.symbols,
                mode: gameState.mode
            });
            
            // Sort and keep top 10
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 10);
        }
        
        // Enhanced game loop
        function gameLoop(currentTime) {
            if (!gameState.running) return;
            
            // Handle pause state
            if (gameState.paused) {
                // Draw paused game state (static)
                drawBackground();
                drawPlayer();
                drawObstacles();
                drawSymbols();
                drawAIOpponents();
                drawParticles();
                
                // Draw pause overlay (only on desktop)
                if (!isMobile) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 48px Orbitron, monospace';
                    ctx.textAlign = 'center';
                    ctx.fillText('PAUSED', canvas.width / 2, canvas.height / 2 - 50);
                    
                    ctx.font = '24px Rajdhani, sans-serif';
                    ctx.fillText('Press ESC, P, or SPACE to continue', canvas.width / 2, canvas.height / 2 + 20);
                }
                
                return; // Don't continue the loop while paused
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Update game logic
            updatePlayer();
            spawnObstacle(currentTime);
            spawnSymbol(currentTime);
            updateObstacles();
            updateSymbols();
            updateAIOpponents();
            updateParticles();
            checkCollisions();
            adjustAIDifficulty();
            
            // Update score and level
            gameState.score += Math.floor(gameState.gameSpeed);
            gameState.level = Math.floor(gameState.score / 2000) + 1;
            
            // Draw everything
            drawBackground();
            drawPlayer();
            drawObstacles();
            drawSymbols();
            drawAIOpponents();
            drawParticles();
            
            updateUI();
            requestAnimationFrame(gameLoop);
        }
        
        // Update UI elements
        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('symbols').textContent = gameState.symbols;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('streak').textContent = gameState.streak;
            document.getElementById('level').textContent = gameState.level;
            
            // Update life progress indicator
            const lifeProgress = document.getElementById('lifeProgress');
            const symbolsToLife = document.getElementById('symbolsToLife');
            
            if (gameState.symbolsForLife > 0) {
                lifeProgress.style.display = 'flex';
                symbolsToLife.textContent = gameState.symbolsForLife;
                
                // Add visual feedback when close to life bonus
                if (gameState.symbolsForLife >= 4) {
                    lifeProgress.style.background = 'linear-gradient(45deg, #27ae60, #2ecc71)';
                    lifeProgress.style.animation = 'pulse 1s infinite';
                } else {
                    lifeProgress.style.background = 'rgba(52, 73, 94, 0.8)';
                    lifeProgress.style.animation = 'none';
                }
            } else {
                lifeProgress.style.display = 'none';
            }
            
            // Update win progress indicator
            const winProgress = document.getElementById('winProgress');
            const livesToWin = document.getElementById('livesToWin');
            
            if (gameState.totalLives > 3) {
                winProgress.style.display = 'flex';
                livesToWin.textContent = gameState.totalLives;
                
                // Add visual feedback when close to victory
                if (gameState.totalLives >= 10) {
                    winProgress.style.background = 'linear-gradient(45deg, #f39c12, #e67e22)';
                    winProgress.style.animation = 'pulse 0.8s infinite';
                } else if (gameState.totalLives >= 8) {
                    winProgress.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                    winProgress.style.animation = 'pulse 1.2s infinite';
                } else {
                    winProgress.style.background = 'rgba(52, 73, 94, 0.8)';
                    winProgress.style.animation = 'none';
                }
            } else {
                winProgress.style.display = 'none';
            }
        }
        
        // Enhanced game start function
        function startGame(mode = 'classic') {
            // Initialize audio if not already done
            if (!audioContext) {
                initAudio();
            }
            
            // Initialize mobile controls
            detectMobile();
            if (isMobile) {
                initMobileControls();
                resizeCanvas();
            }
            
            gameState = {
                running: true,
                paused: false,
                mode: mode,
                score: 0,
                symbols: 0,
                lives: mode === 'survival' ? 1 : 3,
                level: 1,
                streak: 0,
                maxStreak: 0,
                gameSpeed: mode === 'festival' ? 1.5 : 2,
                aiDifficulty: 'Easy',
                lastObstacleTime: 0,
                lastSymbolTime: 0,
                lastDifficultyAdjust: 0,
                symbolsForLife: 0,
                totalLives: mode === 'survival' ? 1 : 3
            };
            
            // Reset player with enhanced jump
            player.x = 100;
            player.y = 615;
            player.velocityY = 0;
            player.grounded = true;
            player.powerUp = null;
            player.jumpPower = -16; // Higher jump power
            
            // Reset performance tracking
            playerPerformance = {
                jumpsSuccessful: 0,
                jumpsFailed: 0,
                symbolsCollected: 0,
                symbolsMissed: 0,
                averageReactionTime: 500
            };
            
            // Initialize game objects
            obstacles = [];
            adinkraSymbols = [];
            particles = [];
            initBackground();
            
            if (mode === 'competitive') {
                initAIOpponents();
            }
            
            // Hide all screens
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('modeSelectScreen').style.display = 'none';
            document.getElementById('puzzleScreen').style.display = 'none';
            
            requestAnimationFrame(gameLoop);
        }
        
        function gameOver() {
            gameState.running = false;
            updateLeaderboard();
            
            // Play game over sound
            playSound('gameOver');
            
            // Update final stats
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalSymbols').textContent = gameState.symbols;
            document.getElementById('maxStreak').textContent = gameState.maxStreak;
            document.getElementById('finalDifficulty').textContent = gameState.aiDifficulty;
            
            // Mode-specific game over messages
            const subtitle = document.getElementById('gameOverSubtitle');
            switch (gameState.mode) {
                case 'competitive':
                    subtitle.textContent = 'The race is over! Check your ranking.';
                    break;
                case 'festival':
                    subtitle.textContent = 'The festival celebration ends!';
                    break;
                case 'survival':
                    subtitle.textContent = 'You survived as long as you could!';
                    break;
                default:
                    subtitle.textContent = 'Your journey through Ghana has concluded';
            }
            
            updateLeaderboardDisplay();
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        function pauseGame() {
            if (gameState.running && !gameState.paused) {
                gameState.paused = true;
                // Only show pause screen on desktop
                if (!isMobile) {
                    document.getElementById('pauseScreen').style.display = 'flex';
                }
                playSound('collect'); // Play a pause sound
            }
        }
        
        function resumeGame() {
            if (gameState.running && gameState.paused) {
                gameState.paused = false;
                // Only hide pause screen on desktop
                if (!isMobile) {
                    document.getElementById('pauseScreen').style.display = 'none';
                }
                playSound('collect'); // Play a resume sound
                requestAnimationFrame(gameLoop); // Restart the game loop
            }
        }
        
        function victory() {
            gameState.running = false;
            
            // Play victory sound
            playSound('victory');
            
            // Hide all screens and show victory screen
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('modeSelectScreen').style.display = 'none';
            document.getElementById('puzzleScreen').style.display = 'none';
            document.getElementById('pauseScreen').style.display = 'none';
            
            // Show victory screen
            document.getElementById('victoryScreen').style.display = 'block';
            
            // Create victory celebration particles
            setTimeout(() => {
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        createParticles(
                            Math.random() * canvas.width,
                            Math.random() * canvas.height,
                            ['#f39c12', '#e67e22', '#d35400', '#e74c3c'][Math.floor(Math.random() * 4)],
                            'legendary'
                        );
                    }, i * 100);
                }
            }, 1000);
        }
        
        function playAgain() {
            // Hide victory screen
            document.getElementById('victoryScreen').style.display = 'none';
            
            // Reset game state and start new game
            startGame(gameState.mode);
        }
        
        function shareVictory() {
            // Create shareable text
            const shareText = `🏆 I completed the Adinkra Kwantuo quest and returned home to Ghana! 🏆\n\nScore: ${gameState.score}\nSymbols Collected: ${gameState.symbols}\nTotal Lives: ${gameState.totalLives}\n\n#AdinkraKwantuo #Ghana #WarriorKing`;
            
            // Try to use native sharing if available
            if (navigator.share) {
                navigator.share({
                    title: 'Adinkra Kwantuo Victory',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // Fallback to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    showAchievement('Victory shared to clipboard! 📋');
                }).catch(() => {
                    showAchievement('Share feature not available');
                });
            }
        }
        
        function restartGame() {
            startGame(gameState.mode);
        }
        
        // Initialize the game
        document.addEventListener('DOMContentLoaded', () => {
            initBackground();
            updateLeaderboardDisplay();
            
            // Initialize mobile detection
            detectMobile();
            
            // Handle window resize for responsive design
            window.addEventListener('resize', () => {
                if (gameState.running) {
                    resizeCanvas();
                }
            });
            
            // Initialize audio on first user interaction
            document.addEventListener('click', () => {
                if (!audioContext) {
                    initAudio();
                }
            }, { once: true });
            
            document.addEventListener('touchstart', () => {
                if (!audioContext) {
                    initAudio();
                }
            }, { once: true });
            
            // Initialize global rankings
            updateRankingsDisplay();
        });
        
        // Initialize immediately if DOM is already loaded
        if (document.readyState === 'loading') {
            // DOM is still loading
        } else {
            // DOM is already loaded
            initBackground();
            updateLeaderboardDisplay();
            detectMobile();
        }
    </script>
</body>
</html>
